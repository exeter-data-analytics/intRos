{
  "hash": "fd2949b8fd998930785dad0ff0412c1d",
  "result": {
    "markdown": "---\ntitle: \"intRos: Publication ready plots using ggplot2\"\nauthor: \n  - name: Daniel Padfield\n    affiliation: University of Exeter\ndescription: \"Make publication ready plots in R using ggplot2 and learn some new tips and tricks\"\ndate: \"MM/DD/YYYY\"\ndate-modified: last-modified\ncategories: [R, ggplot2, tidyverse]\nexecute:\n  message: false\n  warning: false\n---\n\n\n# Outline\n\nThis is where we discuss the need and rationale for this walkthrough.\n\n# Prerequisites\n\n- Have R installed\n- Have the **tidyverse** package installed\n- Hopefully have a plot you want to make using **ggplot2** or have some aesthetics you would like to change on a current plot.\n\n# Learning objectives\n\n::: callout-note\n# Learning objectives\n\n**This introduction should allow you to:**\n\n- Have a basic understanding of the way in which **ggplot2** \"works\" (i.e. the grammar of graphics)\n- Understand the format data needs to be in to be used in **ggplot2**\n- Make pubication-ready plots using **ggplot2**\n- Know where to learn more about **ggplot2**\n:::\n\n# Making plots with ggplot2\n\nThis walkthrough will lean heavy on tools from the **tidyverse** for data wrangling, and the **palmerpenguins** package for the example data. The first thing we will do is load in the necessary packages and load in the dataset we will use to create our tables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load in required packages\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\n# load in data\ndata(\"penguins\")\nd <- penguins\n\n# have a look at the data\nglimpse(d)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <fct> male, female, female, NA, female, male, female, male…\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n:::\n:::\n\n\nThis dataset contain data for 344 penguins, consisting of three species of penguins, collected from 3 islands in the Palmer Archipelago, Antarctica.\n\n## Preparing your dataset for ggplot2\n\nFor **ggplot2**, your data wants to be organised in long format, as opposed to wide.\n\n## Make a first plot using ggplot2\n\nWe will make a boxplot of how bill length changes between different species of penguin. And then we will add the raw points over the top. In each layer, the **aes()** function is used to tell **ggplot2** which arguments depend on aspects of the dataset (e.g. col = species). Arguments set outside of **aes()** do not rely on the dataset (e.g. size = 3, col = 'black').\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# make first box plot with raw points\nggplot(d, aes(species, bill_length_mm, col = species)) + # add first empty plot layer\n  geom_boxplot(outlier.shape = NA) + # add boxplot, do not plot the outliers\n  geom_jitter(width = 0.2) # add jittered raw points\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/first_plot-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nOk this looks nice. Here I put the **aes()** commands inside the original call to **ggplot()** as then those arguments are passed to all other layers (unless overridden by another **aes()**). This looks quite nice, but we can change a bunch of other things to make it look nicer.\n\n## Adding extra layers to ggplot2\n\nThere are a bunch of things I do as standard when I am making a plot (and a boxplot in particular):\n\n- Change the axis labels\n- Remove the legend if not needed\n- Change the axis limits\n- Change the theme and the text size\n- I dislike the default box plot so I colour the whole thing and then add a median bar in white (see below)\n\nThe important thing is to create your own style. To do what you think looks best, but all the options are documented nicely on their [website](https://ggplot2.tidyverse.org/). There are many more detailed resources around, so instead here we will document common things we do.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# make next box plot with raw points\np1 <- ggplot(d, aes(species, bill_length_mm, col = species, fill = species)) + # add first empty plot layer\n  geom_boxplot(outlier.shape = NA) + # add boxplot, do not plot the outliers\n  stat_summary(geom = \"crossbar\", fatten = 2, color = \"white\", width = 0.4, \n               fun.data = function(x){return(c(y = stats::median(x), ymin = stats::median(x), ymax = stats::median(x)))}) + # add median line to the boxplots\n  geom_jitter(width = 0.2, shape = 21, fill = 'white') + # add jittered raw points\n  theme_bw(base_size = 14) + # change theme to the one I like (others are available)\n  labs(x = 'Species',\n       y = 'Bill length (mm)',\n       title = 'Do different penguin species have different bill lengths?') + # change labels\n  ylim(c(30,65)) + # change y limits\n  guides(col = 'none',\n         fill = 'none') # turn off legend\n\np1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/second_plot-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nAnd there - with relatively few lines of code - we have a plot that is ready for inserting into a publication. This can be easily saved out using **ggsave()**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# save out plot using ggsave\nggsave('plot_one.png', p1, width = 5, height = 7)\n```\n:::\n\n\n## Our favourite tips and tricks when making plots\n\nI have a set of rules I follow when making plots with **ggplot2**. Some may be different to yours but they might have some use:\n\n- Generally I make my datasets **BEFORE** they go into **ggplot2**. This includes checking for `NA` and `Inf` values as these are super important to know about when visualising and analysing your data! \n- Layers work iteratively (later layers go on top of earlier layers) so make sure layers you want to be in the background (e.g. boxplot) are before layers you want to overlay (e.g. the raw data)\n- Only use **stat_smooth()** for exploring datasets. When plotting model predictions and confidence intervals, create a dataframe for them and then feed that into **ggplot2**.\n\n### Convert text size in geom_label() or geom_text() to pts used for labels\n\nLets say we wanted to add text to the plot. For example, in the plot above maybe we want to add the total number of penguins sampled for each species. By default **geom_text()** and **geom_label()** use a size guide that is different to the font size set for the axis and tick labels. However, Andrew Heiss has written a function to convert between those so we can easily define the font size in the regular way. \n\nWe will use functions from the **tidyverse** to create a data frame with the total number of penguins sampled and the max bill length for each penguin. Creating a data frame with the x and y coordinates of where I want the text to go on the plot, and a column for the label, is how I approach adding text labels to an existing **ggplot**.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# define function for pts\npts <- function(x){\n    as.numeric(grid::convertX(grid::unit(x, \"points\"), \"mm\"))\n  }\n\n# calculate n for putting each species\n# remove NAs because they are not in the plot\nd_n <- filter(d, !is.na(bill_length_mm)) %>%\n  group_by(species) %>%\n  summarise(n = n(),\n            max_bill_length = max(bill_length_mm)) %>%\n  ungroup()\n\n# make plot with text\n# make next box plot with raw points\np1 +\n  geom_text(aes(x = species, y = max_bill_length + 5, label = paste('n = ', n, sep = '')), d_n, size = pts(12), col = 'black') # add text label\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/example_geom_text-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Soft wrap text labels using scales::label_wrap()\n\n### Automatically label facets with letters\n\n### Beautiful colour schemes with MetBrewer\n\n### Add a final NULL layer to allow you to comment out layers\n\nIt is common for me to play around with different layers and switch some on and off with a hashtag. If you hash out the final layer then the layer before it with a `+` carries on to the next set of code. If you add a final `+ NULL` to the plot then this behaviour doesn't happen.\n\nLets say we wanted to see the plot without the text labels. We can turn them off by hashtagging them out (in case we want to add them back in later), and the final `NULL` means the plot still works.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 +\n  #geom_text(aes(x = species, y = max_bill_length + 5, label = paste('n = ', n, sep = '')), d_n, size = pts(12), col = 'black') + # add text label\n  NULL # add NULL layer to allow easy commenting out of layers\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot_null-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n## Awesome ggplot2 extensions\n\n**gpgplot2** is so popular as a plotting system that it has become its own ecosystem, with people developing tools and extensions to complement and build extra functionality to **ggplot2**. Below are some of our favourites:\n\n- ggdist\n- ggtree\n- patchwork\n\n# Summary\n\n### Additional Resources\n\n### Acknowledgements\n\nWe did not create this content alone! Inspiration, tips, and resources have been borrowed from multiple sources.\n\n-   Add here.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}